<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hydroinformatics - 17&nbsp; Intro to Modeling - Calibrate HBV</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./16-Modeling-Getting-Started-HBV.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.2/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<link rel="stylesheet" href="include/webex.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./17-Calibrate-HBV.html"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Intro to Modeling - Calibrate HBV</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Hydroinformatics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Plotting_Demo_COMPLETE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Intro to Plotting</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Programming_Basics_Demo_COMPLETE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R Tidyverse Programming Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-Activity-Intro-Skills.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">ACTIVITY Intro Skills</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Intro-Stats-Completed.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Introduction to Basic Statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Intro-Stats-Activity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Intro Stats Activity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Get-Format-Plot-hydrodata_COMPLETE.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Joins, Pivots, and USGS dataRetrieval</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Activity-Joins-Pivots_dataRetrieval.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">ACTIVITY: Joins Pivots dataRetrieval</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Summative_Activity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">ACTIVITY Summative 1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-Flow_Duration_Curves.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Flow Duration Curves</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-LowFlowStats-FDC.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Low Flow Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-Flood_Frequency.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Flood Frequency Analysis and Creating Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Intro-Geospatial-R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Geospatial data in R - Vector</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-Summative-Assessment-2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Summative Assessment 2</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-Geospatial-Raster-Hydro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Geospatial R Raster - Hydro Analyses</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-Watershed-Delineation-and-Analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Geospatial R Raster - Watershed Delineation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-Modeling-Getting-Started-HBV.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Intro to Modeling - Getting Started with HBV</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-Calibrate-HBV.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Intro to Modeling - Calibrate HBV</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">17.1</span> Introduction</a></li>
  <li><a href="#challenge-write-a-for-loop" id="toc-challenge-write-a-for-loop" class="nav-link" data-scroll-target="#challenge-write-a-for-loop"><span class="header-section-number">17.2</span> Challenge: Write a for loop</a></li>
  <li><a href="#prep-data-for-hbv" id="toc-prep-data-for-hbv" class="nav-link" data-scroll-target="#prep-data-for-hbv"><span class="header-section-number">17.3</span> Prep data for HBV</a></li>
  <li><a href="#calculate-pet" id="toc-calculate-pet" class="nav-link" data-scroll-target="#calculate-pet"><span class="header-section-number">17.4</span> Calculate PET</a></li>
  <li><a href="#monte-carlo-step-1-generate-random-parameter-sets" id="toc-monte-carlo-step-1-generate-random-parameter-sets" class="nav-link" data-scroll-target="#monte-carlo-step-1-generate-random-parameter-sets"><span class="header-section-number">17.5</span> Monte Carlo step 1: generate random parameter sets</a></li>
  <li><a href="#run-the-model-for-each-parameter-set" id="toc-run-the-model-for-each-parameter-set" class="nav-link" data-scroll-target="#run-the-model-for-each-parameter-set"><span class="header-section-number">17.6</span> Run the model for each parameter set</a></li>
  <li><a href="#find-the-best-parameter-set" id="toc-find-the-best-parameter-set" class="nav-link" data-scroll-target="#find-the-best-parameter-set"><span class="header-section-number">17.7</span> Find the best parameter set</a></li>
  <li><a href="#investigating-a-much-bigger-monte-carlo" id="toc-investigating-a-much-bigger-monte-carlo" class="nav-link" data-scroll-target="#investigating-a-much-bigger-monte-carlo"><span class="header-section-number">17.8</span> Investigating a much bigger Monte Carlo</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="modelingcalibration" class="quarto-section-identifier"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Intro to Modeling - Calibrate HBV</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">17.1</span> Introduction</h2>
<p>The following activity is available as a template github repository at the following link: <a href="https://github.com/VT-Hydroinformatics/17-calibrate-model-for-loops" class="uri">https://github.com/VT-Hydroinformatics/17-calibrate-model-for-loops</a></p>
<p><em>Goals for this activity:</em></p>
<ul>
<li>Learn how for loops work</li>
<li>Use for loops to calibrate the HBV model using the Monte Carlo technique</li>
<li>Assess the results of the calibration, discuss equifinality</li>
</ul>
<p>We saw in the last activity that coming up with the parameters that create a model that fits our watershed discharge best is hard. For this reason, there are several ways people have devised for automating the process. We are going to explore one: a Monte Carlo calibration.</p>
<p>To use this approach, we will create a ton of random parameter sets, run the model for each, and then see which one fits best. The idea is that by creating a bunch of random sets of parameters, we will end up with at least one that works well. As you might guess, this can take a while. We will just do this for 100 or 1000 runs here in this activity, but we will also explore some output from a 100,000 run Monte Carlo that I ran and saved.</p>
<p>There is one new package this time, GGally, just for creating a parallel coordinate plot to look at the results of the 100k run Monte Carlo at the end.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally) <span class="co">#for making parallel coordinate plot</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_classic</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to do what we are going to do, we need “for” loops.</p>
<p>A for loop is a way to run a chunk of code several times while changing a value in that chunk of code each time.</p>
<p>So using an example from class: you could run some code that downloads data from a USGS gage, and each time through the loop it changes which gage you download.</p>
<p>In R, the syntax for this is</p>
<blockquote class="blockquote">
<p>for(x in sequence){<br>
x<br>
}<br>
</p>
</blockquote>
<p>Where x will change every time you go through the loop. The values x will have each time through the loop are those that are in “sequence” above. If you changed this to x in 1:3, x would have values of 1, 2, and 3 each time through. If you made it x in c(2,3,5) x would change to 2, then 3, and then 5 each time through the loop. You can make the sequence anything and x can have any name so “letter in c(a, b, c)” would have <em>letter</em> change to a, then b, then c each time through the loop.</p>
<p>The image below shows a short example of how a for loop works.</p>
<p><img src="images/for loop.png" title="for loop" class="img-fluid" alt="for loop"> Let’s try some examples</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>val <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  val[x] <span class="ot">&lt;-</span> x</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>days <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mon"</span>,<span class="st">"tues"</span>,<span class="st">"wednes"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(x <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(days)){</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  days[x] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(days[x], <span class="st">"day"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>days</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "monday"    "tuesday"   "wednesday"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>gages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"123"</span>,<span class="st">"ABC"</span>,<span class="st">"001"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(g <span class="cf">in</span> gages){</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(g)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "123"
[1] "ABC"
[1] "001"</code></pre>
</div>
</div>
</section>
<section id="challenge-write-a-for-loop" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="challenge-write-a-for-loop"><span class="header-section-number">17.2</span> Challenge: Write a for loop</h2>
<p>Define a vector with values 5, 6, 7, 8, 9</p>
<p>Create a for loop that steps through this vector and adds 1 to each value.</p>
<p>Yes, you can do this by just typing the name of the vector + 1, but that’s not the point!</p>
</section>
<section id="prep-data-for-hbv" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="prep-data-for-hbv"><span class="header-section-number">17.3</span> Prep data for HBV</h2>
<p>Since we did this in the last chapter, we are just going to quickly run the code the preps our data to go into the model. Below we load the HBV model and make vectors of P, Qobs, and Temp.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create the HBV function with the HBV R file</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">'HBV/HBV.R'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">#set start and end dates for model to filter data</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> <span class="fu">mdy</span>(<span class="st">"01-01-2009"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>end <span class="ot">&lt;-</span> <span class="fu">mdy</span>(<span class="st">"12-31-2012"</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Precip</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"HBV/Pwd2009-2012.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>         <span class="fu">select</span>(DATE, WS_3) <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">ymd</span>(DATE)) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(DATE <span class="sc">&gt;=</span> start <span class="sc">&amp;</span> DATE <span class="sc">&lt;=</span> end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1461 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (10): DATE, WS_1, WS_2, WS_3, WS_4, WS_5, WS_6, WS_7, WS_8, WS_9

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> P1<span class="sc">$</span>WS_3</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Streamflow mm/d</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>Qobs1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"HBV/SWD2009-2012.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">select</span>(DATE, WS_3) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">ymd</span>(DATE)) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(DATE <span class="sc">&gt;=</span> start <span class="sc">&amp;</span> DATE <span class="sc">&lt;=</span> end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1461 Columns: 10
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (10): DATE, WS_1, WS_2, WS_3, WS_4, WS_5, WS_6, WS_7, WS_8, WS_9

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>Qobs <span class="ot">&lt;-</span> Qobs1<span class="sc">$</span>WS_3</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Temp in deg C</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>Temp1 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"HBV/Tdm2009-2012.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">select</span>(DATE, STA_1) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">ymd</span>(DATE)) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(DATE <span class="sc">&gt;=</span> start <span class="sc">&amp;</span> DATE <span class="sc">&lt;=</span> end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 1461 Columns: 9
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
dbl (9): DATE, STA_1, STA_6, STA_14, STA_INT, STA_HQ, STA_23, STA_17, STA_24

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>Temp <span class="ot">&lt;-</span> Temp1<span class="sc">$</span>STA_1</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Snow in SWE, mm</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>snow <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"HBV/sno2009-2012.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">select</span>(DATE, STA2) <span class="sc">%&gt;%</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">DATE =</span> <span class="fu">ymd</span>(DATE)) <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">filter</span>(DATE <span class="sc">&gt;=</span> start <span class="sc">&amp;</span> DATE <span class="sc">&lt;=</span> end)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 76 Columns: 25
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(1): DATE dbl (21): STA1, STA2, STA3, STA4, STA5, STA6, STA7, STA8, STA9,
STA10, STA11... lgl (3): ...23, ...24, ...25
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `` -&gt; `...23`
• `` -&gt; `...24`
• `` -&gt; `...25`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `DATE = ymd(DATE)`.
Caused by warning:
!  8 failed to parse.</code></pre>
</div>
</div>
</section>
<section id="calculate-pet" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="calculate-pet"><span class="header-section-number">17.4</span> Calculate PET</h2>
<p>Again, because we did this last time, we will just re-run this code to create our PET values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>lat <span class="ot">&lt;-</span> <span class="dv">43</span> <span class="sc">+</span> <span class="dv">57</span><span class="sc">/</span><span class="dv">60</span> <span class="co">#43 degrees and 57 minutes</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>latrad <span class="ot">&lt;-</span> (lat<span class="sc">/</span><span class="dv">360</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi <span class="co">#convert to radians</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>PET1 <span class="ot">&lt;-</span> <span class="fu">select</span>(Temp1, DATE) <span class="sc">%&gt;%</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">DOY =</span> <span class="fu">yday</span>(DATE)) <span class="sc">%&gt;%</span> <span class="co">#DOY for dates</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">tempvar =</span> (<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">365</span>) <span class="sc">*</span> DOY) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>         <span class="co">#declination of the sun above the celestial equator in </span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>         <span class="co">#radians on day JulDay of the year</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">delta_h =</span> <span class="fl">0.4093</span> <span class="sc">*</span> <span class="fu">sin</span>(tempvar <span class="sc">-</span> <span class="fl">1.405</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>         <span class="co">#day length in h</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(<span class="at">daylen =</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">acos</span>(<span class="sc">-</span><span class="fu">tan</span>(delta_h) <span class="sc">*</span> <span class="fu">tan</span>(latrad)) <span class="sc">/</span> <span class="fl">0.2618</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">mutate</span>(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">PET =</span> <span class="fl">29.8</span> <span class="sc">*</span> daylen <span class="sc">*</span> <span class="fl">0.611</span> <span class="sc">*</span> <span class="fu">exp</span>(<span class="fl">17.3</span> <span class="sc">*</span> Temp <span class="sc">/</span> </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                  (Temp <span class="sc">+</span> <span class="fl">237.3</span>)) <span class="sc">/</span> (Temp <span class="sc">+</span> <span class="fl">273.2</span>))  <span class="co">#PET Hamon method</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>PET <span class="ot">&lt;-</span> PET1<span class="sc">$</span>PET</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="monte-carlo-step-1-generate-random-parameter-sets" class="level2" data-number="17.5">
<h2 data-number="17.5" class="anchored" data-anchor-id="monte-carlo-step-1-generate-random-parameter-sets"><span class="header-section-number">17.5</span> Monte Carlo step 1: generate random parameter sets</h2>
<p>Below is a table of the parameters for the HBV model and their suggested min and max values for our application. What we basically want to do is mimic you sitting down at the computer and randomly changing all the parameters, running the model, and checking to see how well it did. Over, and over, and over.</p>
<p>You can do this by generating the set of parameters each time you run the model, but we are going to do it separately so we can see the Nashe-Sutcliff efficiency (NSE) for each set of parameters.</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Object Name</th>
<th>Min</th>
<th>Max</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>FC</td>
<td>40</td>
<td>400</td>
<td>Max soil moisture storage, field capacity</td>
</tr>
<tr class="even">
<td>beta</td>
<td>1</td>
<td>6</td>
<td>Shape coefficient governing fate of water input to soil moisture storage</td>
</tr>
<tr class="odd">
<td>LP</td>
<td>.3</td>
<td>1</td>
<td>Threshold for reduction of evaporation</td>
</tr>
<tr class="even">
<td>SFCF</td>
<td>0.4</td>
<td>1.2</td>
<td>Snowfall correction factor</td>
</tr>
<tr class="odd">
<td>TT</td>
<td>-1.5</td>
<td>1.2</td>
<td>Threshold temperature</td>
</tr>
<tr class="even">
<td>CFMAX</td>
<td>1</td>
<td>8</td>
<td>Degree-day factor</td>
</tr>
<tr class="odd">
<td>k0</td>
<td>0.05</td>
<td>0.5</td>
<td>Recession constant (upper storage, near surface)</td>
</tr>
<tr class="even">
<td>k1</td>
<td>0.01</td>
<td>0.3</td>
<td>Recession constant (upper storage)</td>
</tr>
<tr class="odd">
<td>k2</td>
<td>0.001</td>
<td>0.15</td>
<td>Recession constant (lower storage)</td>
</tr>
<tr class="even">
<td>UZL</td>
<td>0</td>
<td>70</td>
<td>Threshold for shallow storage</td>
</tr>
<tr class="odd">
<td>PERC</td>
<td>0</td>
<td>4</td>
<td>Percolation, max flow from upper to lower storage</td>
</tr>
<tr class="even">
<td>MAXBAS</td>
<td>1</td>
<td>3</td>
<td>base of the triangular routing function, days”</td>
</tr>
</tbody>
</table>
<p>To make our parameter sets, we first have to decide how many model runs we want to try. Let’s try 100 so we don’t burn down anyone’s computer.</p>
<p>Then we will use the runif() function to generate the same number of random values as the number of model runs we want to perform for each parameter, within the bounds of the min and max values above.</p>
<p>Remember, runif() creates a set of random numbers in a uniform distribution with a specified length with a specified minimum and maximum value. A uniform distribution is one where each number has the same probability of occurrence as the next, so it’s basically a set of random numbers between your min and max values.</p>
<p>We will also create a blank vector of the same length which we will populate with the NSE values for each model run, and then slap them all together with cbind() (column bind).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#number of runs</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># PARAMETERS RANGE and generate set</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>FC    <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="dv">40</span>   , <span class="at">max =</span> <span class="dv">400</span>)  <span class="co">#Max soil moisture storage, field capacity</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>beta  <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="dv">1</span>    , <span class="at">max =</span> <span class="dv">6</span>)    <span class="co">#Shape coefficient governing fate of water input to soil moisture storage</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>LP    <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="fl">0.3</span>   , <span class="at">max =</span> <span class="dv">1</span>)    <span class="co">#Threshold for reduction of evap</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>SFCF  <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="fl">0.4</span>  , <span class="at">max =</span> <span class="fl">1.2</span>)  <span class="co">#Snowfall correction factor</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>TT    <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="sc">-</span><span class="fl">1.5</span> , <span class="at">max =</span> <span class="fl">1.2</span>)  <span class="co">#Threshold temperature</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>CFMAX <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="dv">1</span>    , <span class="at">max =</span> <span class="dv">8</span>)    <span class="co">#Degree-day factor</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>k0    <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="fl">0.05</span> , <span class="at">max =</span> <span class="fl">0.5</span>)  <span class="co">#Recession constant (upper storage, near surface)</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>k1    <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="fl">0.01</span> , <span class="at">max =</span> <span class="fl">0.3</span>)  <span class="co">#Recession constant (upper storage)</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>k2    <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="fl">0.001</span>, <span class="at">max =</span> <span class="fl">0.15</span>) <span class="co">#Recession constant (lower storage)</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>UZL   <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="dv">0</span>    , <span class="at">max =</span> <span class="dv">70</span>)   <span class="co">#Threshold for shallow storage</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>PERC  <span class="ot">&lt;-</span> <span class="fu">runif</span>(N, <span class="at">min =</span> <span class="dv">0</span>    , <span class="at">max =</span> <span class="dv">4</span>)    <span class="co">#Percolation, max flow from upper to lower storage</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>MAXBAS<span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, N)   <span class="co">#base of the triangular routing function, days</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">#MAXBAS is just 1's because routing will be set to zero, so the parameter isn't used</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>NSE <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, N) <span class="co">#create NSE column, to be filled in for loop</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>routing <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>pars <span class="ot">&lt;-</span> <span class="fu">cbind</span>(FC, beta, LP, SFCF, </span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>               TT, CFMAX, k0, k1, </span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>               k2, UZL, PERC, MAXBAS, NSE) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="run-the-model-for-each-parameter-set" class="level2" data-number="17.6">
<h2 data-number="17.6" class="anchored" data-anchor-id="run-the-model-for-each-parameter-set"><span class="header-section-number">17.6</span> Run the model for each parameter set</h2>
<p>Alright, let’s get at this. We now have our random sets of parameters. So we will run the model for each and see how it does.</p>
<p>Here’s how we will do that:</p>
<p>First: Define the period for which we want to calculate NSE. Remember we are going to drop the first 40% of the model run to let the model “warm up”. Since we are starting with nothing in the storages we need to let the boxes “fill up” and settle in.</p>
<p>Then we run a FOR LOOP!</p>
<p>Our for loop will step through a sequence of numbers from 1 to the total number of parameter sets we have. So in this case: 100. We will use i as our variable. So i will be 1, 2, 3…. all the way to 100.</p>
<p>In the code portion of the loop, it will grab the parameters from row i of the parameter set we created. And pass that to the HBV function with the Precip, Temp, and PET data. Remember routing is just set to zero.</p>
<p>After we run the model (still in the for loop) we will stick our observed values onto the results and then trip them to the period we want to evaluate. (drop the first 40%)</p>
<p>Finally, we calculate NSE for that individual model run, and then add it into the NSE column we made before. So each run will just tack on an NSE value to the end of the parameter set. We don’t need to save the model results, because we can just rerun the model with the same parameters and it’ll give us the same output.</p>
<p>The figure below illustrates how the for loop will work:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/monte carlo for loop.png" title="Monte Carlo for loop" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">monte carlo for loop</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#trim the first 40% (warm up) of Qobs off for NSE calculation </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>EvalStart <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">length</span>(Qobs) <span class="sc">*</span> <span class="fl">0.4</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>EvalEnd <span class="ot">&lt;-</span> <span class="fu">length</span>(Qobs)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>   <span class="co">#call model with i parameter set generated above</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>   results <span class="ot">&lt;-</span> <span class="fu">HBV</span>(pars[i,<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>], P, Temp, PET, routing)</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>   <span class="co">#add the Qobs to results</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>   results <span class="ot">&lt;-</span> <span class="fu">cbind</span>(results, Qobs)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>   <span class="co">#trim the first 40% of the record so it isn't included in the NSE calculation</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>   results <span class="ot">&lt;-</span> results[EvalStart<span class="sc">:</span>EvalEnd,]</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>   <span class="co">#Calculate NSE and add to parameter set</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>   pars[i,<span class="dv">13</span>]  <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> ((<span class="fu">sum</span>((results<span class="sc">$</span>Qobs <span class="sc">-</span> results<span class="sc">$</span>q) <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> <span class="fu">sum</span>((results<span class="sc">$</span>Qobs <span class="sc">-</span> <span class="fu">mean</span>(results<span class="sc">$</span>Qobs)) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="find-the-best-parameter-set" class="level2" data-number="17.7">
<h2 data-number="17.7" class="anchored" data-anchor-id="find-the-best-parameter-set"><span class="header-section-number">17.7</span> Find the best parameter set</h2>
<p>Alright, now we have a NSE value that tells us how well each parameter set did at estimating runoff. So we need to find the best one!</p>
<p>To do this, we will convert the parameter sets to a tibble, use filter to grab the row with the maximum NSE, then use slice to pull just that row out of the tibble. Finally, we will run as.numeric on the data to be sure everything is numbers.</p>
<p>Now we have our best parameter set, let’s see how it did!</p>
<p>We will do what we did in the previous lesson: run the model with the parameter set, slap on the observed data, and filter it to the time period we want to look at. (after 08-07-2010 in this case, that’s the 40% cutoff in this case)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#find best parameters</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>pars <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(pars)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>bestparams <span class="ot">&lt;-</span> pars <span class="sc">%&gt;%</span> <span class="fu">filter</span>(NSE <span class="sc">==</span> <span class="fu">max</span>(NSE)) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">as.numeric</span>()</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#run with best parameters</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>modeloutput <span class="ot">&lt;-</span>  <span class="fu">HBV</span>(bestparams, P, Temp, PET, routing)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#add observations for plotting</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>modeloutput <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(modeloutput, Qobs1)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="co">#trim out warm up period for plotting</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>OutputTrim <span class="ot">&lt;-</span> <span class="fu">filter</span>(modeloutput, DATE <span class="sc">&gt;=</span> <span class="fu">mdy</span>(<span class="st">"08-07-2010"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below we will look at the model run using plotly. First, we calculate the NSE again, just to be sure, and then plot the same way we did in the last lesson.</p>
<p>How did the model do? Did the 100 run Monte Carlo do better or worse than your manual attempts from last lesson?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate NSE</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>NSE <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> ((<span class="fu">sum</span>((OutputTrim<span class="sc">$</span>q <span class="sc">-</span> OutputTrim<span class="sc">$</span>WS_3) <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">/</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">sum</span>((OutputTrim<span class="sc">$</span>WS_3 <span class="sc">-</span> <span class="fu">mean</span>(OutputTrim<span class="sc">$</span>WS_3)) <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Create plot with NSE in title</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>OutputTrim <span class="sc">%&gt;%</span> <span class="fu">plot_ly</span>(<span class="at">x =</span> <span class="sc">~</span>DATE) <span class="sc">%&gt;%</span> </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_trace</span>(<span class="at">y =</span> <span class="sc">~</span>q, <span class="at">name =</span> <span class="st">'Modeled'</span>,  <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add_trace</span>(<span class="at">y =</span> <span class="sc">~</span>WS_3, <span class="at">name =</span> <span class="st">'Measured'</span>, <span class="at">type =</span> <span class="st">'scatter'</span>, <span class="at">mode =</span> <span class="st">'lines'</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">layout</span>(<span class="at">title=</span><span class="fu">paste</span>(<span class="st">"NSE: "</span>, <span class="fu">round</span>(NSE,<span class="dv">2</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-b41263456f3868aa7926" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-b41263456f3868aa7926">{"x":{"visdat":{"477b1a2937eb":["function () ","plotlyVisDat"]},"cur_data":"477b1a2937eb","attrs":{"477b1a2937eb":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"name":"Modeled","type":"scatter","mode":"lines","inherit":true},"477b1a2937eb.1":{"x":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"y":{},"name":"Measured","type":"scatter","mode":"lines","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"NSE:  0.69","xaxis":{"domain":[0,1],"automargin":true,"title":"DATE"},"yaxis":{"domain":[0,1],"automargin":true,"title":"q"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["2010-08-07","2010-08-08","2010-08-09","2010-08-10","2010-08-11","2010-08-12","2010-08-13","2010-08-14","2010-08-15","2010-08-16","2010-08-17","2010-08-18","2010-08-19","2010-08-20","2010-08-21","2010-08-22","2010-08-23","2010-08-24","2010-08-25","2010-08-26","2010-08-27","2010-08-28","2010-08-29","2010-08-30","2010-08-31","2010-09-01","2010-09-02","2010-09-03","2010-09-04","2010-09-05","2010-09-06","2010-09-07","2010-09-08","2010-09-09","2010-09-10","2010-09-11","2010-09-12","2010-09-13","2010-09-14","2010-09-15","2010-09-16","2010-09-17","2010-09-18","2010-09-19","2010-09-20","2010-09-21","2010-09-22","2010-09-23","2010-09-24","2010-09-25","2010-09-26","2010-09-27","2010-09-28","2010-09-29","2010-09-30","2010-10-01","2010-10-02","2010-10-03","2010-10-04","2010-10-05","2010-10-06","2010-10-07","2010-10-08","2010-10-09","2010-10-10","2010-10-11","2010-10-12","2010-10-13","2010-10-14","2010-10-15","2010-10-16","2010-10-17","2010-10-18","2010-10-19","2010-10-20","2010-10-21","2010-10-22","2010-10-23","2010-10-24","2010-10-25","2010-10-26","2010-10-27","2010-10-28","2010-10-29","2010-10-30","2010-10-31","2010-11-01","2010-11-02","2010-11-03","2010-11-04","2010-11-05","2010-11-06","2010-11-07","2010-11-08","2010-11-09","2010-11-10","2010-11-11","2010-11-12","2010-11-13","2010-11-14","2010-11-15","2010-11-16","2010-11-17","2010-11-18","2010-11-19","2010-11-20","2010-11-21","2010-11-22","2010-11-23","2010-11-24","2010-11-25","2010-11-26","2010-11-27","2010-11-28","2010-11-29","2010-11-30","2010-12-01","2010-12-02","2010-12-03","2010-12-04","2010-12-05","2010-12-06","2010-12-07","2010-12-08","2010-12-09","2010-12-10","2010-12-11","2010-12-12","2010-12-13","2010-12-14","2010-12-15","2010-12-16","2010-12-17","2010-12-18","2010-12-19","2010-12-20","2010-12-21","2010-12-22","2010-12-23","2010-12-24","2010-12-25","2010-12-26","2010-12-27","2010-12-28","2010-12-29","2010-12-30","2010-12-31","2011-01-01","2011-01-02","2011-01-03","2011-01-04","2011-01-05","2011-01-06","2011-01-07","2011-01-08","2011-01-09","2011-01-10","2011-01-11","2011-01-12","2011-01-13","2011-01-14","2011-01-15","2011-01-16","2011-01-17","2011-01-18","2011-01-19","2011-01-20","2011-01-21","2011-01-22","2011-01-23","2011-01-24","2011-01-25","2011-01-26","2011-01-27","2011-01-28","2011-01-29","2011-01-30","2011-01-31","2011-02-01","2011-02-02","2011-02-03","2011-02-04","2011-02-05","2011-02-06","2011-02-07","2011-02-08","2011-02-09","2011-02-10","2011-02-11","2011-02-12","2011-02-13","2011-02-14","2011-02-15","2011-02-16","2011-02-17","2011-02-18","2011-02-19","2011-02-20","2011-02-21","2011-02-22","2011-02-23","2011-02-24","2011-02-25","2011-02-26","2011-02-27","2011-02-28","2011-03-01","2011-03-02","2011-03-03","2011-03-04","2011-03-05","2011-03-06","2011-03-07","2011-03-08","2011-03-09","2011-03-10","2011-03-11","2011-03-12","2011-03-13","2011-03-14","2011-03-15","2011-03-16","2011-03-17","2011-03-18","2011-03-19","2011-03-20","2011-03-21","2011-03-22","2011-03-23","2011-03-24","2011-03-25","2011-03-26","2011-03-27","2011-03-28","2011-03-29","2011-03-30","2011-03-31","2011-04-01","2011-04-02","2011-04-03","2011-04-04","2011-04-05","2011-04-06","2011-04-07","2011-04-08","2011-04-09","2011-04-10","2011-04-11","2011-04-12","2011-04-13","2011-04-14","2011-04-15","2011-04-16","2011-04-17","2011-04-18","2011-04-19","2011-04-20","2011-04-21","2011-04-22","2011-04-23","2011-04-24","2011-04-25","2011-04-26","2011-04-27","2011-04-28","2011-04-29","2011-04-30","2011-05-01","2011-05-02","2011-05-03","2011-05-04","2011-05-05","2011-05-06","2011-05-07","2011-05-08","2011-05-09","2011-05-10","2011-05-11","2011-05-12","2011-05-13","2011-05-14","2011-05-15","2011-05-16","2011-05-17","2011-05-18","2011-05-19","2011-05-20","2011-05-21","2011-05-22","2011-05-23","2011-05-24","2011-05-25","2011-05-26","2011-05-27","2011-05-28","2011-05-29","2011-05-30","2011-05-31","2011-06-01","2011-06-02","2011-06-03","2011-06-04","2011-06-05","2011-06-06","2011-06-07","2011-06-08","2011-06-09","2011-06-10","2011-06-11","2011-06-12","2011-06-13","2011-06-14","2011-06-15","2011-06-16","2011-06-17","2011-06-18","2011-06-19","2011-06-20","2011-06-21","2011-06-22","2011-06-23","2011-06-24","2011-06-25","2011-06-26","2011-06-27","2011-06-28","2011-06-29","2011-06-30","2011-07-01","2011-07-02","2011-07-03","2011-07-04","2011-07-05","2011-07-06","2011-07-07","2011-07-08","2011-07-09","2011-07-10","2011-07-11","2011-07-12","2011-07-13","2011-07-14","2011-07-15","2011-07-16","2011-07-17","2011-07-18","2011-07-19","2011-07-20","2011-07-21","2011-07-22","2011-07-23","2011-07-24","2011-07-25","2011-07-26","2011-07-27","2011-07-28","2011-07-29","2011-07-30","2011-07-31","2011-08-01","2011-08-02","2011-08-03","2011-08-04","2011-08-05","2011-08-06","2011-08-07","2011-08-08","2011-08-09","2011-08-10","2011-08-11","2011-08-12","2011-08-13","2011-08-14","2011-08-15","2011-08-16","2011-08-17","2011-08-18","2011-08-19","2011-08-20","2011-08-21","2011-08-22","2011-08-23","2011-08-24","2011-08-25","2011-08-26","2011-08-27","2011-08-28","2011-08-29","2011-08-30","2011-08-31","2011-09-01","2011-09-02","2011-09-03","2011-09-04","2011-09-05","2011-09-06","2011-09-07","2011-09-08","2011-09-09","2011-09-10","2011-09-11","2011-09-12","2011-09-13","2011-09-14","2011-09-15","2011-09-16","2011-09-17","2011-09-18","2011-09-19","2011-09-20","2011-09-21","2011-09-22","2011-09-23","2011-09-24","2011-09-25","2011-09-26","2011-09-27","2011-09-28","2011-09-29","2011-09-30","2011-10-01","2011-10-02","2011-10-03","2011-10-04","2011-10-05","2011-10-06","2011-10-07","2011-10-08","2011-10-09","2011-10-10","2011-10-11","2011-10-12","2011-10-13","2011-10-14","2011-10-15","2011-10-16","2011-10-17","2011-10-18","2011-10-19","2011-10-20","2011-10-21","2011-10-22","2011-10-23","2011-10-24","2011-10-25","2011-10-26","2011-10-27","2011-10-28","2011-10-29","2011-10-30","2011-10-31","2011-11-01","2011-11-02","2011-11-03","2011-11-04","2011-11-05","2011-11-06","2011-11-07","2011-11-08","2011-11-09","2011-11-10","2011-11-11","2011-11-12","2011-11-13","2011-11-14","2011-11-15","2011-11-16","2011-11-17","2011-11-18","2011-11-19","2011-11-20","2011-11-21","2011-11-22","2011-11-23","2011-11-24","2011-11-25","2011-11-26","2011-11-27","2011-11-28","2011-11-29","2011-11-30","2011-12-01","2011-12-02","2011-12-03","2011-12-04","2011-12-05","2011-12-06","2011-12-07","2011-12-08","2011-12-09","2011-12-10","2011-12-11","2011-12-12","2011-12-13","2011-12-14","2011-12-15","2011-12-16","2011-12-17","2011-12-18","2011-12-19","2011-12-20","2011-12-21","2011-12-22","2011-12-23","2011-12-24","2011-12-25","2011-12-26","2011-12-27","2011-12-28","2011-12-29","2011-12-30","2011-12-31","2012-01-01","2012-01-02","2012-01-03","2012-01-04","2012-01-05","2012-01-06","2012-01-07","2012-01-08","2012-01-09","2012-01-10","2012-01-11","2012-01-12","2012-01-13","2012-01-14","2012-01-15","2012-01-16","2012-01-17","2012-01-18","2012-01-19","2012-01-20","2012-01-21","2012-01-22","2012-01-23","2012-01-24","2012-01-25","2012-01-26","2012-01-27","2012-01-28","2012-01-29","2012-01-30","2012-01-31","2012-02-01","2012-02-02","2012-02-03","2012-02-04","2012-02-05","2012-02-06","2012-02-07","2012-02-08","2012-02-09","2012-02-10","2012-02-11","2012-02-12","2012-02-13","2012-02-14","2012-02-15","2012-02-16","2012-02-17","2012-02-18","2012-02-19","2012-02-20","2012-02-21","2012-02-22","2012-02-23","2012-02-24","2012-02-25","2012-02-26","2012-02-27","2012-02-28","2012-02-29","2012-03-01","2012-03-02","2012-03-03","2012-03-04","2012-03-05","2012-03-06","2012-03-07","2012-03-08","2012-03-09","2012-03-10","2012-03-11","2012-03-12","2012-03-13","2012-03-14","2012-03-15","2012-03-16","2012-03-17","2012-03-18","2012-03-19","2012-03-20","2012-03-21","2012-03-22","2012-03-23","2012-03-24","2012-03-25","2012-03-26","2012-03-27","2012-03-28","2012-03-29","2012-03-30","2012-03-31","2012-04-01","2012-04-02","2012-04-03","2012-04-04","2012-04-05","2012-04-06","2012-04-07","2012-04-08","2012-04-09","2012-04-10","2012-04-11","2012-04-12","2012-04-13","2012-04-14","2012-04-15","2012-04-16","2012-04-17","2012-04-18","2012-04-19","2012-04-20","2012-04-21","2012-04-22","2012-04-23","2012-04-24","2012-04-25","2012-04-26","2012-04-27","2012-04-28","2012-04-29","2012-04-30","2012-05-01","2012-05-02","2012-05-03","2012-05-04","2012-05-05","2012-05-06","2012-05-07","2012-05-08","2012-05-09","2012-05-10","2012-05-11","2012-05-12","2012-05-13","2012-05-14","2012-05-15","2012-05-16","2012-05-17","2012-05-18","2012-05-19","2012-05-20","2012-05-21","2012-05-22","2012-05-23","2012-05-24","2012-05-25","2012-05-26","2012-05-27","2012-05-28","2012-05-29","2012-05-30","2012-05-31","2012-06-01","2012-06-02","2012-06-03","2012-06-04","2012-06-05","2012-06-06","2012-06-07","2012-06-08","2012-06-09","2012-06-10","2012-06-11","2012-06-12","2012-06-13","2012-06-14","2012-06-15","2012-06-16","2012-06-17","2012-06-18","2012-06-19","2012-06-20","2012-06-21","2012-06-22","2012-06-23","2012-06-24","2012-06-25","2012-06-26","2012-06-27","2012-06-28","2012-06-29","2012-06-30","2012-07-01","2012-07-02","2012-07-03","2012-07-04","2012-07-05","2012-07-06","2012-07-07","2012-07-08","2012-07-09","2012-07-10","2012-07-11","2012-07-12","2012-07-13","2012-07-14","2012-07-15","2012-07-16","2012-07-17","2012-07-18","2012-07-19","2012-07-20","2012-07-21","2012-07-22","2012-07-23","2012-07-24","2012-07-25","2012-07-26","2012-07-27","2012-07-28","2012-07-29","2012-07-30","2012-07-31","2012-08-01","2012-08-02","2012-08-03","2012-08-04","2012-08-05","2012-08-06","2012-08-07","2012-08-08","2012-08-09","2012-08-10","2012-08-11","2012-08-12","2012-08-13","2012-08-14","2012-08-15","2012-08-16","2012-08-17","2012-08-18","2012-08-19","2012-08-20","2012-08-21","2012-08-22","2012-08-23","2012-08-24","2012-08-25","2012-08-26","2012-08-27","2012-08-28","2012-08-29","2012-08-30","2012-08-31","2012-09-01","2012-09-02","2012-09-03","2012-09-04","2012-09-05","2012-09-06","2012-09-07","2012-09-08","2012-09-09","2012-09-10","2012-09-11","2012-09-12","2012-09-13","2012-09-14","2012-09-15","2012-09-16","2012-09-17","2012-09-18","2012-09-19","2012-09-20","2012-09-21","2012-09-22","2012-09-23","2012-09-24","2012-09-25","2012-09-26","2012-09-27","2012-09-28","2012-09-29","2012-09-30","2012-10-01","2012-10-02","2012-10-03","2012-10-04","2012-10-05","2012-10-06","2012-10-07","2012-10-08","2012-10-09","2012-10-10","2012-10-11","2012-10-12","2012-10-13","2012-10-14","2012-10-15","2012-10-16","2012-10-17","2012-10-18","2012-10-19","2012-10-20","2012-10-21","2012-10-22","2012-10-23","2012-10-24","2012-10-25","2012-10-26","2012-10-27","2012-10-28","2012-10-29","2012-10-30","2012-10-31","2012-11-01","2012-11-02","2012-11-03","2012-11-04","2012-11-05","2012-11-06","2012-11-07","2012-11-08","2012-11-09","2012-11-10","2012-11-11","2012-11-12","2012-11-13","2012-11-14","2012-11-15","2012-11-16","2012-11-17","2012-11-18","2012-11-19","2012-11-20","2012-11-21","2012-11-22","2012-11-23","2012-11-24","2012-11-25","2012-11-26","2012-11-27","2012-11-28","2012-11-29","2012-11-30","2012-12-01","2012-12-02","2012-12-03","2012-12-04","2012-12-05","2012-12-06","2012-12-07","2012-12-08","2012-12-09","2012-12-10","2012-12-11","2012-12-12","2012-12-13","2012-12-14","2012-12-15","2012-12-16","2012-12-17","2012-12-18","2012-12-19","2012-12-20","2012-12-21","2012-12-22","2012-12-23","2012-12-24","2012-12-25","2012-12-26","2012-12-27","2012-12-28","2012-12-29","2012-12-30","2012-12-31"],"y":[0.70304733705336775,0.63648943410638448,0.81902289330203693,0.7414852856735501,0.67128821576940423,0.60773675183712283,0.55020175135428284,0.4981136327901538,0.89800819403529042,0.81299269511741823,0.73602570766258335,0.6663452710101414,0.60326155997226993,0.54615005572048214,0.49444536318708543,0.86631653567458966,0.86821191083898053,0.78601714181746385,1.1730047594461208,1.1222731822850909,1.0160260576217461,0.91983749097236323,0.8327552253207281,0.75391715506064516,0.68254279124776496,0.6179255348464382,0.55942568147777194,0.57996635569590194,0.62510956721659927,0.57511318798801958,0.52066643153141445,0.47137422403381268,0.48355132501252301,0.44443245080164256,0.47414166140109015,0.42410852358779677,0.41209181983849619,0.47919227716862356,0.47068270808526164,0.43408043680176617,0.8866132998043732,0.90670985418395356,0.82141052843083329,0.74411686685366452,0.67407996667894843,0.6106206621863145,0.58251960477667841,0.52764226351834465,0.56306814588067289,0.50996693580815167,0.46186639257899431,0.82227753804323633,2.4908170645541898,1.579629309261064,14.290464095361244,23.451874670632908,12.914405646175286,7.1114327432425934,3.9157717507659107,2.1559672686694955,2.9488901213966332,2.8834184302252681,2.4355658748985967,1.5751559827228483,1.4260595747019029,1.2910749997865962,1.1688667012258238,1.0582255057487042,1.0595804108667051,12.482555233937754,7.7648879705422766,4.5144172520589034,2.4860454694831433,1.5815000722619406,1.4317837328370955,2.2602582648844747,1.5553548433918023,1.4081115107966782,1.6218930850805486,3.8627994195861097,3.8667690692489272,7.2285608384899556,3.9808049956528944,2.6625906484124746,1.6021138845940219,1.5431693487591309,1.4188796379261521,1.3063829283087329,1.2045627107098611,5.6457366784177552,9.0021734244841323,5.2544791236032689,2.8936776965621926,2.7281612377318005,1.6097494352235504,1.457352568669199,1.3193832799311787,1.1944756960383134,1.081393252352028,0.97901645086505806,0.88633177742633085,0.84415327641469395,9.3199103157312937,5.1325463155250874,2.8265323944184355,1.6211714993776403,1.4676930125216234,1.3287445378214606,2.7518067723466482,1.6125010998716682,1.4598434188396499,1.3216380473903386,1.1965167659847953,1.0832408862379379,0.9806889880361529,0.88784581759746151,13.470258594948561,8.8215499797300296,4.8580963411033418,2.6753914817306366,1.603634678035599,1.4518163586133976,1.3143708897467232,1.1899375738116789,1.0772845323031635,0.97529651035213238,0.8829638358058538,16.619692838132231,18.177875374933723,10.010697925333481,5.5129695143424025,3.0360353502770363,1.671968361870229,1.4871967482313373,1.3464017617043642,1.2189360325011624,1.1035376612872965,0.99906421449294047,0.90448141432295059,0.81885289949938322,0.74133095536873284,0.6711481216027898,0.6076095944101112,0.55008634804068401,0.49800890748729615,0.45086171073391917,0.60115299805980982,1.362727882133272,1.7348256000771782,1.4944907957875504,1.3530052701753559,1.2249143763702384,1.1089500259203271,1.0039641820738328,0.90891749431739211,0.82286900889849446,0.74496685346708214,0.67443980361510236,0.61058964782350544,0.55278427523034512,0.5004514177894992,0.45307298486794001,0.39809512657110657,0.34669569751463752,0.30193262527591286,0.26294906703350679,0.22899880988550986,0.19943198704065968,0.17368263824109306,0.15125787630164014,0.13172845239443826,0.11472053948205295,0.099908576619768541,0.087009037154586577,0.075775001533454595,0.06599143083486439,0.057471050551018733,0.050050765829019739,0.043588539552579401,0.037960673505322673,0.033059440572434436,0.028791022656884078,0.025073714838368538,0.021836361399462115,0.019016993781801526,0.016561644400425891,0.014423313610621286,0.012561070053223917,0.010939267157431118,0.0095268608036253501,0.0082968150850944722,0.0072255847938972649,0.0062926647247562341,0.0054801971698727608,0.0047726300914347252,0.7912317114696884,0.72948130887769846,0.671878208357646,0.61824910333483152,0.56840877669701084,0.52216488457868659,0.47932181519371098,0.43968377123248975,0.403057202410392,0.36925269591645127,0.3346506899980784,0.29144279004861168,0.25381361045993023,0.22104286348603769,0.19250326020566438,0.16764850312460094,18.944827394668209,10.356174705950842,5.6362640802605961,3.0456181541729119,1.6264586508072247,7.5982750277164977,5.6584177631073356,4.2407432801888714,2.3061958851288709,1.5008103427544466,1.3611100575027675,2.824903580288276,6.3415478939989125,3.4777044656868896,1.9024531591618954,1.4877729093321062,1.3479632678479572,1.2212553357988516,1.1064260913993571,1.0023660598202424,0.90806885252422842,0.82262165961564637,0.7451966097982935,0.6750429199992608,0.61147976355371947,0.55388979210550937,0.50171325210651718,0.4544426420367233,0.68778587588544493,1.8106306122783125,6.6317817951101077,5.1732631776104734,4.2859786676927003,5.0986775517489447,8.1511814636183875,15.976140909613271,26.666574214436054,20.878529797621457,17.364491543532502,12.602816639569559,6.9401193196303286,3.8216728956884785,14.818426852318494,11.835494350939152,10.577115785520222,11.920723022638303,8.9086641153298629,8.3125146984823886,13.055151502137214,13.660370993333533,19.389321885389499,28.854619296883051,27.028783247807549,24.010983099867161,13.39714966605483,7.3778709308811807,4.0630128006267405,2.2374994875123004,1.5609725707411388,7.4444548077243695,4.5601211601835372,2.5112751301595835,1.5845512675269349,1.434541158816514,1.2987325137205596,1.175780886022151,1.0644691067272003,0.96369523498802168,0.8724616496735158,1.5221638698242508,11.318731749399548,6.7069748177034816,4.92148666146515,4.8496147752816263,8.1675080303462551,5.6596926884438155,8.5792960381190131,5.0512224143019635,6.1820458078599172,3.4044993185972814,1.8748829776867173,2.2230548040079667,1.6812747801742758,1.4882745505879587,1.3473776113681266,1.4196293368825368,1.2852311149139317,1.1635565514459678,1.0915020065970826,0.98816803400277264,0.89461682699972223,0.80992223825788234,0.73324580001256146,0.66382842332978487,0.61362701882987347,0.71452197191864797,0.64687719771690688,1.1139160461213782,1.1713724634629887,1.7028491698405555,1.629733965316966,1.5287803361441408,1.3986498662144702,1.413120444897525,1.4312418538142957,1.3360916038016206,1.2096019543093137,1.0950872556318796,1.1903441697953916,1.5787160934810802,4.4904147761098772,2.6665029344381459,2.2495587017332608,1.5697788786937146,1.4613015387883921,1.3229580873825781,1.217167870204114,1.1204552342794987,1.0143801769931087,1.0214410324950625,0.92473978745117968,0.83719338392500653,1.0687447976651372,0.96756523906684055,0.88320345262039002,1.0204067493231803,0.92380342097392532,0.83634566427563461,0.75716765522264451,0.70099533244950862,0.63463112783568532,0.57454971491327456,0.52015629304202959,0.47091237218668291,0.58655996277916866,0.53102951397124742,0.48075621010839298,0.43227540517565666,0.37646284295577237,0.32785643233334627,0.28552576232597332,0.35101984242365247,0.36233954293075171,0.32962822360921495,0.28706879154496556,0.37020546249137354,0.34914099927035719,0.31290631449112927,0.27250590554481363,0.26828195288054002,0.24553352928242725,0.24633831268860529,0.21453272708401316,0.19752396918732554,0.30393361263912821,0.29274294257474998,0.33195795439755316,0.47838017893915674,0.437962587791629,0.40074243256434017,0.36649821392206505,0.70009151350700582,2.8130565994335779,4.2794179345546572,2.3369519079991856,1.5381463175646868,1.4043250469792437,1.2727794264667149,6.3674075351594581,4.6441604088231925,2.5489557552377038,1.5712654901431147,2.5356998561452211,1.5740022635434778,1.5769131538403567,36.552618578902752,20.632788241423061,11.359362572019647,6.2528374777282805,3.4410024811828559,1.8928236978936048,1.5083835081822057,3.4275599025860584,8.6318655948525524,7.4514328130032457,10.12247171750144,8.2089071757949554,4.5198873668502282,2.4884214660791097,1.5804690619501667,1.4309022546347681,1.295487605029864,1.1728862822042174,3.7124037933750103,2.0441374691292262,1.5297424290505668,1.3849450613411234,1.253852572445338,1.2528906528351293,1.1342945787309719,1.8117102757733734,2.0001835298591879,1.9854349103288604,1.5233595613192215,1.3791494203031327,1.2485907656944593,1.1303913328030744,6.6394141625676593,12.233219168074628,9.8660307289916123,16.874282145141876,10.233686258707287,5.9091575017701592,3.9247250835970107,2.1613570895456089,1.5439455179440522,1.3977796495018784,1.2654513002655194,1.1456504797654536,1.0371912127009204,0.93899979869708194,1.1161860818376552,13.160761687815247,9.938069445232081,7.285572921172788,4.5214319570330721,2.4899841513658516,2.6582226077160835,4.0150631807803361,2.2111241820943399,1.5976016423857944,1.4463546708569268,1.476289856488525,1.3365275920069755,1.2099967960654845,1.671336519358839,1.6199024295980422,3.1500714556476312,3.2587639492627667,1.7946261402445616,1.5014288352248391,1.3592865262117417,1.2306010210904148,1.1140983463322729,1.008625137148619,0.91313721930727543,0.82668927192272768,0.74842546888274364,0.67757100626279565,1.5583974579779871,1.4672222611821677,1.3283182982628696,1.2025645653959391,1.4136564857124507,1.3227520715765706,1.9199271697476876,1.6033318050101264,1.4515421547826404,1.3141226415024916,1.1897128243765596,1.077081057425068,0.98695866804270826,7.4619168022231355,4.1093358451188067,2.3760608527470479,1.5689002840586808,1.4203703099437375,1.2859018752066695,1.490828171292883,9.076489335110125,5.1347498844758661,2.8277468611885213,1.6213143656941935,1.4678222764558941,1.3288614970754162,1.5756943539483101,6.4380937431298948,3.5455085086907396,1.9525392266804105,1.5197544823949469,1.3758772084272866,1.3023721546696874,1.4142615078749066,1.3030900695668644,8.1490505983808657,5.477967344192372,3.0167594036122263,1.6613529664959663,1.4859649671088673,1.3452865934653309,1.2179264374417516,2.3484556174346576,1.5656969866010617,1.4174702715598453,1.2832763861388381,1.1617868228077357,1.0517988456949454,0.95222358360944148,0.86207525031282461,0.78046138532324671,0.8064574857799971,1.8302171217252496,1.5055601192470638,1.3630266451934039,1.2339870137074311,1.1171637439135516,1.0114002958304538,0.91564962072815181,0.82896379543867926,0.75048463800103149,0.67943521173607557,0.61511213364252382,0.55687861096777769,0.50415813701631107,0.45642878378465584,0.402238506931685,0.35030411180634724,0.30507514480525616,0.26568584507337673,0.23138223311313871,0.20150767830945943,0.17549032988117907,0.15283217066552518,0.1330994842060598,0.1159145526676426,0.10094842666210695,0.087914628586575005,8.033949966982183,5.6399147676772747,3.0196205217294168,1.5877496783130156,1.3230680266278336,1.8717862887608896,1.3933135909597694,1.2660586431739129,1.1502504640457156,1.0448829220272662,0.94903512470066009,0.86186464185075073,0.78260120320378945,0.71054084744566759,0.64504049856497958,0.58551294541067911,0.53142220052627365,0.48227921475084018,0.43763792470223134,0.38839074677443408,0.67162852733478506,1.3776966271873929,1.4039930143666077,1.2723264241384082,1.1529633228953358,1.0447597831226187,1.4752740656544907,2.051127465133181,6.6893443527023315,3.6787988590621477,2.0215232332899258,1.5186843268861088,1.3752689818862378,1.245384407025073,1.1277556370130113,1.0212276331261751,2.4810544282553715,1.6231970375351847,1.469684043646142,1.3306840252041314,1.5324991271051769,8.9298306040718387,9.0447000540787084,4.9802542673795571,3.9977940670738992,9.3605462140820119,11.70666989274539,10.242861907242421,8.3309450994549952,10.147184676157615,10.901333242912564,10.838749036541998,5.9687726104202783,3.286865815077578,1.8099425364521917,1.5028786387468385,1.360612089595576,1.3162640041219758,1.593384922586506,2.0372533114125781,1.5294200707282726,1.5558214742280034,1.6136011100791581,1.5211098920225732,1.3771086226127602,1.3053530821136401,1.1817767661711396,1.0698991688669366,0.96861281087023765,0.87691505240391399,0.79389816884911413,0.71874036578856637,0.68993319974901268,1.4947286592124724,1.3532216995667312,1.2251112608519792,1.1091290938547431,1.0041270139462184,0.90906553470228302,0.82300357755561149,0.74508915561545397,0.67455093943365152,0.6106906212256179,0.55287600195876618,0.50053473287640149,1.0906718151886592,4.1315746545647851,12.234599821912438,7.4371472590817609,4.0956938186063558,5.9062419597047127,4.1760688753964823,2.2997929111101345,1.5600484029293284,1.4123565154740232,5.7067622945300585,3.6547497839967553,2.7696796318511652,6.4867784569824281,3.8625178318150186,2.1271184627303441,1.5400122530334606,7.8194469891483855,6.0824734793081099,10.125917819552489,6.7907772536423421,3.7397339550453244,2.0595005945896174,1.9530928494324726,18.778296866078382,14.098822520344447,8.5322690936380834,4.6987871821935618,2.5876587572567349,1.5934542439124415,1.5538071817237464,1.5718028354306961,1.4229980739787844,1.2882808662439917,1.4958801972120965,1.3542631367320053,1.2260531604286082,1.1682456199215892,15.314284670514621,8.5544950718844532,4.7110272460308922,2.5943994943471482,16.863267903369419,11.754643919840044,8.3215701725897659,4.7449772073579348,5.2965982265919251,3.1990835208652517,4.597276525430857,2.5619572889113842,1.5904719112249945,1.4398997197201262,5.0279743752973882,9.6899198986617066,5.3363145743606761,2.938750116659901,1.6341952977990402,1.4794837522550703,1.339418964263146,1.2126143048811771,1.0978144192607056,0.99388279874559282,0.89979052953743444,0.81460610654049559,0.73748621154413363,3.991733327959246,2.384580603077914,2.2483326848954923,1.5540786306525058,1.4069518415346867,1.2737537505202039,1.2008481961401769,1.0999647903602214,0.99582959117540082,1.4790137814554536,1.3389934861832267,1.2122291073423188,1.0974656888559131,0.99356708308739816,0.89950470307980779,0.81434733963642592,0.73725194243255698,0.66745527389228865,0.6042663532043685,0.54705961567362549,0.52574770049758013,0.50023314709346189,0.56610944803970753,0.51550279837946,0.4666994302499422,0.41491959997079586,0.36134790536973638,0.31469303625156847,0.37540742643190933,0.47835262470799522,0.43642838060568312,0.47459497665864314,0.45101185282910827,0.56447309737115925,0.82030155219644985,0.74432674066037974,0.67532710730074985,0.72061156482055333,0.65350276108137262,0.5926036029715841,0.53734476032460254,0.76177978661696866,0.69030098170958731,0.62550654885866008,0.56677433737412497,1.4470780137621881,16.056687705454475,11.205039486440697,7.6625386470812433,4.2175595121613494,2.3206744384695703,3.1969672092645305,1.7591017963858113,1.6041362120012974,1.4523922122889361,1.3149983010840756,1.1905979661280846,1.0779628558883334,0.97598068025459384,0.88364425232276611,0.80004156380190572,0.72434679668143875,0.6558121829495005,1.0314955280583651,2.0961440511392042,1.5358350362075015,1.3904585794476216,1.2856569363594095,1.1639595881648135,1.3843966212726948,1.2533472017273408,1.4962123247228216,3.1778557627798545,1.7499880954673857,1.4960821244808717,4.4347491575341715,2.4421969073990466,1.5764637492096849,1.4272221430041609,1.2921088777691745,1.1697864773519637,1.0590440768315688,0.95878543728356491,0.86801809504536764,0.78584353809780028,13.800408365671775,8.6157532166689705,4.7447507707896923,2.6129610141399962,2.3674804319237222,2.0444183645346965,1.5304001935677312,1.3855157121861044,1.3095361702791033,1.2199554361098661,1.7232913736775499,1.5809068780299809,1.6003040909611133,3.3538755384159118,1.8470032055434282,4.5026752217318924,3.4801873937848589,1.9684560328188607,3.1426299998248046,2.7751006218652572,1.7627007518469622,1.4977234424596211,2.5467086954555596,1.6052497629083342,1.7987621277216324,1.5019088936878695,2.7130299533118518,2.3296732122456927,1.6027166297897788,1.4509852439486564,1.3136184758704528,8.3015152576143443,6.1046482017677004,3.747831169109654,2.0639597571917006,1.5326835372441892,1.3875822629743753,1.2562179270043796,1.1372900344395789,1.029621210024007,0.93214554223584511,3.0079988382259719,13.976932055466339,8.4882062473527355,4.6745214457563424,2.6704853142900351,1.603065543919737,1.451301097983847,1.3139044032594016,1.1895152447639312,1.0769021809569932,1.1015729774578404,1.0351838340321211,0.93718153932978487,0.84845725826315022,0.76813262837340812,1.5825793983798191,1.4327544024906986,1.2971135476194515,1.174314001384883,1.063140059216819,0.96249110898929746,0.87137073505867901,0.78887685383763007,0.71419278324804414,0.64657915764128171,0.60259467139960587,0.64218032170868145,0.58138421609368596,0.52634376248161807,0.47651406528079115,0.42703765995045861,0.37190136100572985,0.32388389898436554,0.28206613640141676,1.3931481226596456,2.1507897522774897,1.5627471328645073,3.8539445909281898,2.0926835986531569,1.4750091786739441,1.3975305383092211,1.2805269347337502,7.7966767961200256,4.2788052224157269,2.3434077983474033,1.5384944952715192,1.3939007405708397,1.2628593196242091,1.1441048456447975,1.0364894513083192,4.5757148032667896,4.3049687305333562,2.4766881366596052,11.341241070373036,6.2424565979260178,3.4349362261264975,1.8891786556497498,1.5073357343340152,1.3648354800056641,1.2357999302120779,1.118957718671054,1.0131574078057808,0.91735619087359033,0.83060965645649398],"name":"Modeled","type":"scatter","mode":"lines","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["2010-08-07","2010-08-08","2010-08-09","2010-08-10","2010-08-11","2010-08-12","2010-08-13","2010-08-14","2010-08-15","2010-08-16","2010-08-17","2010-08-18","2010-08-19","2010-08-20","2010-08-21","2010-08-22","2010-08-23","2010-08-24","2010-08-25","2010-08-26","2010-08-27","2010-08-28","2010-08-29","2010-08-30","2010-08-31","2010-09-01","2010-09-02","2010-09-03","2010-09-04","2010-09-05","2010-09-06","2010-09-07","2010-09-08","2010-09-09","2010-09-10","2010-09-11","2010-09-12","2010-09-13","2010-09-14","2010-09-15","2010-09-16","2010-09-17","2010-09-18","2010-09-19","2010-09-20","2010-09-21","2010-09-22","2010-09-23","2010-09-24","2010-09-25","2010-09-26","2010-09-27","2010-09-28","2010-09-29","2010-09-30","2010-10-01","2010-10-02","2010-10-03","2010-10-04","2010-10-05","2010-10-06","2010-10-07","2010-10-08","2010-10-09","2010-10-10","2010-10-11","2010-10-12","2010-10-13","2010-10-14","2010-10-15","2010-10-16","2010-10-17","2010-10-18","2010-10-19","2010-10-20","2010-10-21","2010-10-22","2010-10-23","2010-10-24","2010-10-25","2010-10-26","2010-10-27","2010-10-28","2010-10-29","2010-10-30","2010-10-31","2010-11-01","2010-11-02","2010-11-03","2010-11-04","2010-11-05","2010-11-06","2010-11-07","2010-11-08","2010-11-09","2010-11-10","2010-11-11","2010-11-12","2010-11-13","2010-11-14","2010-11-15","2010-11-16","2010-11-17","2010-11-18","2010-11-19","2010-11-20","2010-11-21","2010-11-22","2010-11-23","2010-11-24","2010-11-25","2010-11-26","2010-11-27","2010-11-28","2010-11-29","2010-11-30","2010-12-01","2010-12-02","2010-12-03","2010-12-04","2010-12-05","2010-12-06","2010-12-07","2010-12-08","2010-12-09","2010-12-10","2010-12-11","2010-12-12","2010-12-13","2010-12-14","2010-12-15","2010-12-16","2010-12-17","2010-12-18","2010-12-19","2010-12-20","2010-12-21","2010-12-22","2010-12-23","2010-12-24","2010-12-25","2010-12-26","2010-12-27","2010-12-28","2010-12-29","2010-12-30","2010-12-31","2011-01-01","2011-01-02","2011-01-03","2011-01-04","2011-01-05","2011-01-06","2011-01-07","2011-01-08","2011-01-09","2011-01-10","2011-01-11","2011-01-12","2011-01-13","2011-01-14","2011-01-15","2011-01-16","2011-01-17","2011-01-18","2011-01-19","2011-01-20","2011-01-21","2011-01-22","2011-01-23","2011-01-24","2011-01-25","2011-01-26","2011-01-27","2011-01-28","2011-01-29","2011-01-30","2011-01-31","2011-02-01","2011-02-02","2011-02-03","2011-02-04","2011-02-05","2011-02-06","2011-02-07","2011-02-08","2011-02-09","2011-02-10","2011-02-11","2011-02-12","2011-02-13","2011-02-14","2011-02-15","2011-02-16","2011-02-17","2011-02-18","2011-02-19","2011-02-20","2011-02-21","2011-02-22","2011-02-23","2011-02-24","2011-02-25","2011-02-26","2011-02-27","2011-02-28","2011-03-01","2011-03-02","2011-03-03","2011-03-04","2011-03-05","2011-03-06","2011-03-07","2011-03-08","2011-03-09","2011-03-10","2011-03-11","2011-03-12","2011-03-13","2011-03-14","2011-03-15","2011-03-16","2011-03-17","2011-03-18","2011-03-19","2011-03-20","2011-03-21","2011-03-22","2011-03-23","2011-03-24","2011-03-25","2011-03-26","2011-03-27","2011-03-28","2011-03-29","2011-03-30","2011-03-31","2011-04-01","2011-04-02","2011-04-03","2011-04-04","2011-04-05","2011-04-06","2011-04-07","2011-04-08","2011-04-09","2011-04-10","2011-04-11","2011-04-12","2011-04-13","2011-04-14","2011-04-15","2011-04-16","2011-04-17","2011-04-18","2011-04-19","2011-04-20","2011-04-21","2011-04-22","2011-04-23","2011-04-24","2011-04-25","2011-04-26","2011-04-27","2011-04-28","2011-04-29","2011-04-30","2011-05-01","2011-05-02","2011-05-03","2011-05-04","2011-05-05","2011-05-06","2011-05-07","2011-05-08","2011-05-09","2011-05-10","2011-05-11","2011-05-12","2011-05-13","2011-05-14","2011-05-15","2011-05-16","2011-05-17","2011-05-18","2011-05-19","2011-05-20","2011-05-21","2011-05-22","2011-05-23","2011-05-24","2011-05-25","2011-05-26","2011-05-27","2011-05-28","2011-05-29","2011-05-30","2011-05-31","2011-06-01","2011-06-02","2011-06-03","2011-06-04","2011-06-05","2011-06-06","2011-06-07","2011-06-08","2011-06-09","2011-06-10","2011-06-11","2011-06-12","2011-06-13","2011-06-14","2011-06-15","2011-06-16","2011-06-17","2011-06-18","2011-06-19","2011-06-20","2011-06-21","2011-06-22","2011-06-23","2011-06-24","2011-06-25","2011-06-26","2011-06-27","2011-06-28","2011-06-29","2011-06-30","2011-07-01","2011-07-02","2011-07-03","2011-07-04","2011-07-05","2011-07-06","2011-07-07","2011-07-08","2011-07-09","2011-07-10","2011-07-11","2011-07-12","2011-07-13","2011-07-14","2011-07-15","2011-07-16","2011-07-17","2011-07-18","2011-07-19","2011-07-20","2011-07-21","2011-07-22","2011-07-23","2011-07-24","2011-07-25","2011-07-26","2011-07-27","2011-07-28","2011-07-29","2011-07-30","2011-07-31","2011-08-01","2011-08-02","2011-08-03","2011-08-04","2011-08-05","2011-08-06","2011-08-07","2011-08-08","2011-08-09","2011-08-10","2011-08-11","2011-08-12","2011-08-13","2011-08-14","2011-08-15","2011-08-16","2011-08-17","2011-08-18","2011-08-19","2011-08-20","2011-08-21","2011-08-22","2011-08-23","2011-08-24","2011-08-25","2011-08-26","2011-08-27","2011-08-28","2011-08-29","2011-08-30","2011-08-31","2011-09-01","2011-09-02","2011-09-03","2011-09-04","2011-09-05","2011-09-06","2011-09-07","2011-09-08","2011-09-09","2011-09-10","2011-09-11","2011-09-12","2011-09-13","2011-09-14","2011-09-15","2011-09-16","2011-09-17","2011-09-18","2011-09-19","2011-09-20","2011-09-21","2011-09-22","2011-09-23","2011-09-24","2011-09-25","2011-09-26","2011-09-27","2011-09-28","2011-09-29","2011-09-30","2011-10-01","2011-10-02","2011-10-03","2011-10-04","2011-10-05","2011-10-06","2011-10-07","2011-10-08","2011-10-09","2011-10-10","2011-10-11","2011-10-12","2011-10-13","2011-10-14","2011-10-15","2011-10-16","2011-10-17","2011-10-18","2011-10-19","2011-10-20","2011-10-21","2011-10-22","2011-10-23","2011-10-24","2011-10-25","2011-10-26","2011-10-27","2011-10-28","2011-10-29","2011-10-30","2011-10-31","2011-11-01","2011-11-02","2011-11-03","2011-11-04","2011-11-05","2011-11-06","2011-11-07","2011-11-08","2011-11-09","2011-11-10","2011-11-11","2011-11-12","2011-11-13","2011-11-14","2011-11-15","2011-11-16","2011-11-17","2011-11-18","2011-11-19","2011-11-20","2011-11-21","2011-11-22","2011-11-23","2011-11-24","2011-11-25","2011-11-26","2011-11-27","2011-11-28","2011-11-29","2011-11-30","2011-12-01","2011-12-02","2011-12-03","2011-12-04","2011-12-05","2011-12-06","2011-12-07","2011-12-08","2011-12-09","2011-12-10","2011-12-11","2011-12-12","2011-12-13","2011-12-14","2011-12-15","2011-12-16","2011-12-17","2011-12-18","2011-12-19","2011-12-20","2011-12-21","2011-12-22","2011-12-23","2011-12-24","2011-12-25","2011-12-26","2011-12-27","2011-12-28","2011-12-29","2011-12-30","2011-12-31","2012-01-01","2012-01-02","2012-01-03","2012-01-04","2012-01-05","2012-01-06","2012-01-07","2012-01-08","2012-01-09","2012-01-10","2012-01-11","2012-01-12","2012-01-13","2012-01-14","2012-01-15","2012-01-16","2012-01-17","2012-01-18","2012-01-19","2012-01-20","2012-01-21","2012-01-22","2012-01-23","2012-01-24","2012-01-25","2012-01-26","2012-01-27","2012-01-28","2012-01-29","2012-01-30","2012-01-31","2012-02-01","2012-02-02","2012-02-03","2012-02-04","2012-02-05","2012-02-06","2012-02-07","2012-02-08","2012-02-09","2012-02-10","2012-02-11","2012-02-12","2012-02-13","2012-02-14","2012-02-15","2012-02-16","2012-02-17","2012-02-18","2012-02-19","2012-02-20","2012-02-21","2012-02-22","2012-02-23","2012-02-24","2012-02-25","2012-02-26","2012-02-27","2012-02-28","2012-02-29","2012-03-01","2012-03-02","2012-03-03","2012-03-04","2012-03-05","2012-03-06","2012-03-07","2012-03-08","2012-03-09","2012-03-10","2012-03-11","2012-03-12","2012-03-13","2012-03-14","2012-03-15","2012-03-16","2012-03-17","2012-03-18","2012-03-19","2012-03-20","2012-03-21","2012-03-22","2012-03-23","2012-03-24","2012-03-25","2012-03-26","2012-03-27","2012-03-28","2012-03-29","2012-03-30","2012-03-31","2012-04-01","2012-04-02","2012-04-03","2012-04-04","2012-04-05","2012-04-06","2012-04-07","2012-04-08","2012-04-09","2012-04-10","2012-04-11","2012-04-12","2012-04-13","2012-04-14","2012-04-15","2012-04-16","2012-04-17","2012-04-18","2012-04-19","2012-04-20","2012-04-21","2012-04-22","2012-04-23","2012-04-24","2012-04-25","2012-04-26","2012-04-27","2012-04-28","2012-04-29","2012-04-30","2012-05-01","2012-05-02","2012-05-03","2012-05-04","2012-05-05","2012-05-06","2012-05-07","2012-05-08","2012-05-09","2012-05-10","2012-05-11","2012-05-12","2012-05-13","2012-05-14","2012-05-15","2012-05-16","2012-05-17","2012-05-18","2012-05-19","2012-05-20","2012-05-21","2012-05-22","2012-05-23","2012-05-24","2012-05-25","2012-05-26","2012-05-27","2012-05-28","2012-05-29","2012-05-30","2012-05-31","2012-06-01","2012-06-02","2012-06-03","2012-06-04","2012-06-05","2012-06-06","2012-06-07","2012-06-08","2012-06-09","2012-06-10","2012-06-11","2012-06-12","2012-06-13","2012-06-14","2012-06-15","2012-06-16","2012-06-17","2012-06-18","2012-06-19","2012-06-20","2012-06-21","2012-06-22","2012-06-23","2012-06-24","2012-06-25","2012-06-26","2012-06-27","2012-06-28","2012-06-29","2012-06-30","2012-07-01","2012-07-02","2012-07-03","2012-07-04","2012-07-05","2012-07-06","2012-07-07","2012-07-08","2012-07-09","2012-07-10","2012-07-11","2012-07-12","2012-07-13","2012-07-14","2012-07-15","2012-07-16","2012-07-17","2012-07-18","2012-07-19","2012-07-20","2012-07-21","2012-07-22","2012-07-23","2012-07-24","2012-07-25","2012-07-26","2012-07-27","2012-07-28","2012-07-29","2012-07-30","2012-07-31","2012-08-01","2012-08-02","2012-08-03","2012-08-04","2012-08-05","2012-08-06","2012-08-07","2012-08-08","2012-08-09","2012-08-10","2012-08-11","2012-08-12","2012-08-13","2012-08-14","2012-08-15","2012-08-16","2012-08-17","2012-08-18","2012-08-19","2012-08-20","2012-08-21","2012-08-22","2012-08-23","2012-08-24","2012-08-25","2012-08-26","2012-08-27","2012-08-28","2012-08-29","2012-08-30","2012-08-31","2012-09-01","2012-09-02","2012-09-03","2012-09-04","2012-09-05","2012-09-06","2012-09-07","2012-09-08","2012-09-09","2012-09-10","2012-09-11","2012-09-12","2012-09-13","2012-09-14","2012-09-15","2012-09-16","2012-09-17","2012-09-18","2012-09-19","2012-09-20","2012-09-21","2012-09-22","2012-09-23","2012-09-24","2012-09-25","2012-09-26","2012-09-27","2012-09-28","2012-09-29","2012-09-30","2012-10-01","2012-10-02","2012-10-03","2012-10-04","2012-10-05","2012-10-06","2012-10-07","2012-10-08","2012-10-09","2012-10-10","2012-10-11","2012-10-12","2012-10-13","2012-10-14","2012-10-15","2012-10-16","2012-10-17","2012-10-18","2012-10-19","2012-10-20","2012-10-21","2012-10-22","2012-10-23","2012-10-24","2012-10-25","2012-10-26","2012-10-27","2012-10-28","2012-10-29","2012-10-30","2012-10-31","2012-11-01","2012-11-02","2012-11-03","2012-11-04","2012-11-05","2012-11-06","2012-11-07","2012-11-08","2012-11-09","2012-11-10","2012-11-11","2012-11-12","2012-11-13","2012-11-14","2012-11-15","2012-11-16","2012-11-17","2012-11-18","2012-11-19","2012-11-20","2012-11-21","2012-11-22","2012-11-23","2012-11-24","2012-11-25","2012-11-26","2012-11-27","2012-11-28","2012-11-29","2012-11-30","2012-12-01","2012-12-02","2012-12-03","2012-12-04","2012-12-05","2012-12-06","2012-12-07","2012-12-08","2012-12-09","2012-12-10","2012-12-11","2012-12-12","2012-12-13","2012-12-14","2012-12-15","2012-12-16","2012-12-17","2012-12-18","2012-12-19","2012-12-20","2012-12-21","2012-12-22","2012-12-23","2012-12-24","2012-12-25","2012-12-26","2012-12-27","2012-12-28","2012-12-29","2012-12-30","2012-12-31"],"y":[0.23200000000000001,0.188,0.249,0.307,0.16300000000000001,0.153,0.13900000000000001,0.111,0.107,0.745,0.30199999999999999,0.251,0.14799999999999999,0.14000000000000001,0.13300000000000001,0.48699999999999999,0.77600000000000002,0.45600000000000002,1.419,1.298,0.67400000000000004,0.39800000000000002,0.254,0.20799999999999999,0.158,0.14999999999999999,0.16,0.126,0.19800000000000001,0.127,0.129,0.127,0.156,0.13400000000000001,0.128,0.16300000000000001,0.155,0.27500000000000002,0.30299999999999999,0.22700000000000001,0.42299999999999999,1.673,0.58599999999999997,0.39400000000000002,0.29199999999999998,0.23599999999999999,0.312,0.34699999999999998,0.47699999999999998,0.33400000000000002,0.221,0.39500000000000002,5.9470000000000001,5.298,26.239000000000001,41.661000000000001,12.058,5.1689999999999996,3.2850000000000001,2.4359999999999999,2.1219999999999999,2.3490000000000002,2.0510000000000002,1.827,1.504,1.3140000000000001,1.1950000000000001,1.1000000000000001,1.05,15.584,7.4809999999999999,4.3979999999999997,3.1549999999999998,2.4199999999999999,2.0659999999999998,2.2480000000000002,2.5640000000000001,2.1440000000000001,2.0699999999999998,2.089,4.7590000000000003,10.144,6.2839999999999998,4.0439999999999996,3.2280000000000002,2.9359999999999999,2.3980000000000001,2.125,1.861,3.3399999999999999,11.946,6.2370000000000001,4.0140000000000002,5.1699999999999999,4.194,3.2069999999999999,2.6659999999999999,2.343,1.8280000000000001,1.617,1.498,1.4159999999999999,10.329000000000001,6.1619999999999999,3.8210000000000002,2.9689999999999999,2.419,2.484,3.7320000000000002,3.464,2.625,2.339,1.9990000000000001,1.728,1.5760000000000001,1.5660000000000001,17.949999999999999,22.143000000000001,7.0499999999999998,4.5030000000000001,3.3849999999999998,2.7400000000000002,2.3090000000000002,1.958,1.619,1.4850000000000001,1.4330000000000001,9.0180000000000007,30.670000000000002,11.413,5.6449999999999996,3.8610000000000002,3.0920000000000001,2.552,2.238,1.9550000000000001,1.706,1.627,1.5229999999999999,1.387,1.284,1.202,1.204,1.101,1.024,0.97699999999999998,1.004,2.7930000000000001,5.399,3.4350000000000001,2.3769999999999998,1.9419999999999999,1.647,1.46,1.3340000000000001,1.181,1.0720000000000001,1.0529999999999999,1.0029999999999999,0.94499999999999995,0.80000000000000004,0.71799999999999997,0.70099999999999996,0.76300000000000001,0.82999999999999996,0.86599999999999999,0.872,0.81699999999999995,0.79500000000000004,0.76000000000000001,0.72299999999999998,0.69399999999999995,0.65900000000000003,0.61699999999999999,0.60299999999999998,0.59099999999999997,0.58099999999999996,0.59499999999999997,0.61299999999999999,0.622,0.63900000000000001,0.64900000000000002,0.60399999999999998,0.61799999999999999,0.622,0.60999999999999999,0.59999999999999998,0.59699999999999998,0.59599999999999997,0.59299999999999997,0.60599999999999998,0.59499999999999997,0.55900000000000005,0.55600000000000005,0.77100000000000002,1.8160000000000001,1.7110000000000001,1.143,0.94099999999999995,0.89400000000000002,0.80600000000000005,0.76800000000000002,0.75700000000000001,0.73399999999999999,0.76900000000000002,0.82599999999999996,0.72099999999999997,0.66700000000000004,0.65600000000000003,0.69199999999999995,0.68999999999999995,20.071999999999999,35.228999999999999,9.0980000000000008,5.0659999999999998,3.8849999999999998,9.0839999999999996,9.5950000000000006,5.1790000000000003,3.8889999999999998,3.298,3.2120000000000002,3.847,13.622,10.723000000000001,6.0620000000000003,4.8490000000000002,3.79,3.125,2.7389999999999999,2.3530000000000002,2.129,2.0230000000000001,1.7769999999999999,1.673,1.738,1.871,1.821,1.8560000000000001,2.2320000000000002,2.573,3.4550000000000001,3.2970000000000002,3.2010000000000001,4.4189999999999996,7.2539999999999996,16.446000000000002,54.427,33.418999999999997,18.190999999999999,16.396000000000001,10.760999999999999,6.9619999999999997,27.681000000000001,11.052,7.3860000000000001,7.5119999999999996,6.1760000000000002,5.3090000000000002,4.9290000000000003,10.734,9.5809999999999995,30.515999999999998,11.821999999999999,9.907,8.5690000000000008,5.3029999999999999,3.948,3.218,2.7509999999999999,4.4370000000000003,4.7599999999999998,3.427,2.8130000000000002,2.4180000000000001,2.1000000000000001,1.835,1.6930000000000001,1.5660000000000001,1.452,1.7350000000000001,9.3019999999999996,9.2100000000000009,5.657,5.2549999999999999,11.734999999999999,6.7770000000000001,8.1159999999999997,6.5659999999999998,7.7130000000000001,7.8150000000000004,4.7949999999999999,3.5209999999999999,3.2719999999999998,2.7360000000000002,2.4569999999999999,1.9990000000000001,1.3959999999999999,1.1000000000000001,0.91500000000000004,0.89200000000000002,0.77200000000000002,0.64800000000000002,0.42699999999999999,0.34899999999999998,0.27400000000000002,0.23400000000000001,0.20300000000000001,0.54600000000000004,1.2849999999999999,1.6100000000000001,3.157,1.357,0.82399999999999995,0.55800000000000005,1.0209999999999999,0.77000000000000002,0.53500000000000003,0.33400000000000002,0.27700000000000002,1.0089999999999999,3.8650000000000002,4.3490000000000002,2.339,1.8560000000000001,1.0880000000000001,0.78900000000000003,0.59499999999999997,0.54000000000000004,0.375,0.5,0.55800000000000005,0.32700000000000001,0.34899999999999998,0.504,0.30099999999999999,0.52100000000000002,0.35299999999999998,0.23499999999999999,0.25,0.24399999999999999,0.25600000000000001,0.17999999999999999,0.14000000000000001,0.14399999999999999,0.184,0.18099999999999999,0.079000000000000001,0.078,0.062,0.062,0.067000000000000004,0.072999999999999995,0.152,0.085000000000000006,0.091999999999999998,0.122,0.16700000000000001,0.088999999999999996,0.079000000000000001,0.086999999999999994,0.090999999999999998,0.071999999999999995,0.075999999999999998,0.080000000000000002,0.20300000000000001,0.14899999999999999,0.088999999999999996,0.40799999999999997,0.25900000000000001,0.13100000000000001,0.10299999999999999,0.55700000000000005,3.556,6.6150000000000002,1.895,0.67500000000000004,0.36199999999999999,0.217,1.105,8.1940000000000008,1.6870000000000001,0.77100000000000002,0.91300000000000003,1.363,0.66500000000000004,70.593999999999994,18.437999999999999,5.0860000000000003,2.5699999999999998,1.6080000000000001,1.1379999999999999,0.85899999999999999,0.84299999999999997,3.6699999999999999,8.0850000000000009,8.7560000000000002,11.074999999999999,4.923,2.7040000000000002,1.8100000000000001,1.361,0.94999999999999996,0.73099999999999998,2.3279999999999998,1.913,1.165,0.83199999999999996,0.64600000000000002,0.67900000000000005,0.71099999999999997,1.704,3.0600000000000001,4.2729999999999997,2.3700000000000001,1.4350000000000001,0.95999999999999996,0.76800000000000002,5.3109999999999999,11.334,19.193000000000001,22.093,13.334,6.617,4.4829999999999997,3.238,2.4590000000000001,1.972,1.5860000000000001,1.343,1.1639999999999999,1.071,1.6040000000000001,11.522,14.451000000000001,6.4720000000000004,4.4390000000000001,3.3079999999999998,2.774,3.7650000000000001,2.9740000000000002,2.4710000000000001,2.1850000000000001,1.9350000000000001,1.8480000000000001,1.6950000000000001,1.6719999999999999,1.744,1.6579999999999999,1.5720000000000001,1.6719999999999999,2.3050000000000002,2.3090000000000002,1.9370000000000001,1.6299999999999999,1.4279999999999999,1.2889999999999999,1.256,1.1679999999999999,1.034,1.6479999999999999,2.6850000000000001,1.7669999999999999,1.5580000000000001,1.4870000000000001,2.145,1.923,2.7879999999999998,2.0569999999999999,1.7170000000000001,1.5760000000000001,1.3959999999999999,1.2769999999999999,1.405,1.286,1.659,3.1549999999999998,4.4569999999999999,5.3120000000000003,3.7810000000000001,21.773,6.944,4.3979999999999997,3.367,2.8119999999999998,2.4470000000000001,4.3780000000000001,9.4789999999999992,4.7389999999999999,3.5510000000000002,2.8799999999999999,2.456,2.1779999999999999,2.0059999999999998,3.54,6.6870000000000003,5.1059999999999999,3.488,2.621,2.339,2.0590000000000002,2.4089999999999998,4.0940000000000003,3.3999999999999999,2.5819999999999999,2.2679999999999998,2.0699999999999998,3.8540000000000001,19.039000000000001,6.4859999999999998,4.1799999999999997,3.4460000000000002,3.9750000000000001,7.375,4.1340000000000003,2.863,2.456,2.1080000000000001,1.97,1.774,1.6120000000000001,1.47,1.3120000000000001,2.4590000000000001,1.3340000000000001,1.131,1.1240000000000001,1.115,1.1220000000000001,1.0760000000000001,0.94799999999999995,0.89300000000000002,0.86599999999999999,0.82099999999999995,1.25,8.8710000000000004,3.5990000000000002,2.3919999999999999,3.556,3.6800000000000002,2.4740000000000002,1.99,1.7809999999999999,1.9970000000000001,2.2189999999999999,1.776,1.627,1.464,1.4119999999999999,1.3380000000000001,1.2470000000000001,1.2170000000000001,1.1459999999999999,1.145,1.1259999999999999,1.1599999999999999,1.0669999999999999,0.87,0.78400000000000003,0.79000000000000004,0.76600000000000001,0.76000000000000001,0.73399999999999999,0.77500000000000002,0.79800000000000004,0.82499999999999996,0.83699999999999997,0.85599999999999998,0.80600000000000005,0.71899999999999997,0.69499999999999995,0.70599999999999996,0.71099999999999997,0.69899999999999995,0.72999999999999998,0.76800000000000002,0.78700000000000003,0.78600000000000003,1.018,3.4630000000000001,7.1840000000000002,3.2309999999999999,2.4889999999999999,4.0800000000000001,12.631,12.704000000000001,7.6379999999999999,6.2160000000000002,12.118,19.132999999999999,16.103999999999999,11.335000000000001,7.399,5.3250000000000002,4.0830000000000002,3.2200000000000002,3.6720000000000002,3.335,2.4769999999999999,2.2629999999999999,2.2040000000000002,2.0859999999999999,3.4529999999999998,1.992,1.5780000000000001,1.4299999999999999,1.3580000000000001,1.2649999999999999,1.1180000000000001,1.0129999999999999,1.038,1.8979999999999999,2.0950000000000002,1.6930000000000001,1.462,1.294,1.224,1.139,1.117,1.03,0.94999999999999996,0.92700000000000005,0.91800000000000004,1.431,4.0659999999999998,19.152000000000001,9.8200000000000003,5.4960000000000004,3.8900000000000001,6.7779999999999996,3.972,3.04,2.52,6.3789999999999996,5.3529999999999998,4.7560000000000002,8.827,5.8609999999999998,4.1660000000000004,3.3170000000000002,27.385000000000002,18.609999999999999,12.629,7.319,4.7990000000000004,3.597,2.992,13.381,11.137,8.2599999999999998,5.5620000000000003,3.9500000000000002,2.8759999999999999,2.1070000000000002,1.972,1.6200000000000001,1.3460000000000001,1.7150000000000001,1.764,1.2270000000000001,1.0009999999999999,15.039,12.596,4.444,2.7109999999999999,20.044,17.600999999999999,7.1959999999999997,4.3869999999999996,3.8010000000000002,4.0919999999999996,3.137,3.226,2.0990000000000002,1.571,1.681,13.289,5.0629999999999997,3.0350000000000001,2.2629999999999999,1.8560000000000001,1.359,1.2270000000000001,0.91400000000000003,0.65800000000000003,0.47199999999999998,0.35499999999999998,0.28999999999999998,2.8260000000000001,2.5350000000000001,1.6359999999999999,1.1499999999999999,0.78400000000000003,0.50700000000000001,1.4350000000000001,0.38200000000000001,0.246,0.55900000000000005,0.73599999999999999,0.45700000000000002,0.32800000000000001,0.23400000000000001,0.17499999999999999,0.14499999999999999,0.121,0.104,0.091999999999999998,0.080000000000000002,0.071999999999999995,0.086999999999999994,0.072999999999999995,0.113,0.081000000000000003,0.078,0.073999999999999996,0.071999999999999995,0.086999999999999994,0.255,0.10000000000000001,0.087999999999999995,0.19400000000000001,0.20499999999999999,0.52200000000000002,0.35599999999999998,0.14999999999999999,0.13800000000000001,0.316,0.14599999999999999,0.092999999999999999,0.16300000000000001,0.38200000000000001,0.14899999999999999,0.098000000000000004,2.2949999999999999,28.957000000000001,11.403,5.2859999999999996,2.9510000000000001,1.6699999999999999,1.827,1.52,0.97199999999999998,0.68500000000000005,0.45000000000000001,0.30099999999999999,0.20000000000000001,0.153,0.11,0.097000000000000003,0.083000000000000004,0.108,0.23599999999999999,1.9430000000000001,0.60899999999999999,0.313,0.185,0.16500000000000001,0.28100000000000003,0.23699999999999999,0.53300000000000003,3.6509999999999998,1.3759999999999999,0.73899999999999999,1.595,2.9420000000000002,1.2829999999999999,0.76300000000000001,0.48299999999999998,0.34100000000000003,0.252,0.20300000000000001,0.17499999999999999,0.157,18.486000000000001,20.957999999999998,4.8399999999999999,2.6840000000000002,1.988,2.137,1.4350000000000001,1.1499999999999999,1.0209999999999999,0.97299999999999998,1.5329999999999999,2.1669999999999998,1.8640000000000001,3.319,2.3180000000000001,4.109,4.3520000000000003,3.4329999999999998,2.968,2.786,2.8109999999999999,2.0779999999999998,2.3039999999999998,2.9630000000000001,2.2759999999999998,1.9099999999999999,2.8290000000000002,2.8740000000000001,2.6509999999999998,2.069,1.738,7.9189999999999996,13.907999999999999,6.1100000000000003,4.0519999999999996,2.8719999999999999,2.3839999999999999,2.0379999999999998,1.8300000000000001,1.6899999999999999,1.554,1.7969999999999999,17.856999999999999,18.489999999999998,7.3250000000000002,4.6689999999999996,3.419,2.7410000000000001,2.3109999999999999,1.972,1.786,1.694,1.548,1.49,1.3819999999999999,1.3080000000000001,2.8399999999999999,2.4460000000000002,1.901,1.595,1.3720000000000001,1.194,1.1799999999999999,1.157,1.1040000000000001,1.0449999999999999,1.05,1.014,0.95599999999999996,0.877,0.80400000000000005,0.80900000000000005,0.76600000000000001,0.72199999999999998,0.67000000000000004,1.5669999999999999,5.6310000000000002,2.9470000000000001,4.1070000000000002,2.7229999999999999,2.1019999999999999,1.8660000000000001,1.6619999999999999,6.4930000000000003,7.3120000000000003,3.6840000000000002,2.6509999999999998,2.2280000000000002,1.883,1.6200000000000001,1.5429999999999999,3.0259999999999998,4.7140000000000004,2.9239999999999999,7.1740000000000004,8.3979999999999997,4.226,2.9670000000000001,2.399,2.0169999999999999,1.8999999999999999,1.6850000000000001,1.5569999999999999,1.4570000000000001,1.3340000000000001],"name":"Measured","type":"scatter","mode":"lines","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="investigating-a-much-bigger-monte-carlo" class="level2" data-number="17.8">
<h2 data-number="17.8" class="anchored" data-anchor-id="investigating-a-much-bigger-monte-carlo"><span class="header-section-number">17.8</span> Investigating a much bigger Monte Carlo</h2>
<p>The next couple of code chunks make plots from a Monte Carlo I ran with 100,000 parameter sets.</p>
<p>We will look at the two plots and discuss.</p>
<p>How much difference was there in NSE in the top 100 runs of the 100,000 run set? How much would you expect the parameters to vary between these runs? What do you think it means if they did or did not vary much?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#the [,-1] drops the first column, which is just row numbers</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>pars100 <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"HBV/parsFrom100kRun.csv"</span>)[,<span class="sc">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 100 Columns: 15
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," dbl
(15): ...1, FC, beta, LP, SFCF, TT, CFMAX, k0, k1, k2, UZL, PERC, MAXBAS...
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `` -&gt; `...1`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pars100, <span class="fu">aes</span>(NSE))<span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="17-Calibrate-HBV_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The chunk below creates a parallel coordinate plot. Each parameter is shown, but normalized, where 1 is it’s maximum value from our random sets, and 0 is the minimum value.</p>
<p>Each connected line is a set of parameters. The green line is the set that had the highest NSE.</p>
<p>Look at this plot for a bit and discuss.</p>
<p>Are there any parameters that were always in the same range for these runs? What does that tell you about them? Are there any parameters that look like they spanned almost the whole range for these runs? What does that tell you about them? What does this plot tell you about the model’s representation of the real world?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#filter the 100,000 run to the top ten</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>rankedpars <span class="ot">&lt;-</span> <span class="fu">filter</span>(pars100, ranks <span class="sc">&lt;=</span> <span class="dv">10</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#set the min and max values for each parameter for the plot</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>mins <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">1</span>, <span class="fl">0.3</span> , <span class="fl">0.4</span>, <span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>, <span class="fl">0.05</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>maxs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">400</span>, <span class="dv">6</span>, <span class="dv">1</span>, <span class="fl">1.2</span>, <span class="fl">1.2</span>, <span class="dv">8</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.15</span>, <span class="dv">70</span> , <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">#add maxes and mins to the parameter sets</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>rankedpars <span class="ot">&lt;-</span> <span class="fu">rbind</span>(rankedpars, mins, maxs)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Make NSE a character so the legend will work properly</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>rankedpars <span class="ot">&lt;-</span> rankedpars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">NSE =</span> <span class="fu">as.character</span>(<span class="fu">round</span>(NSE, <span class="dv">2</span>)))</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Make the NSE equal "Min/Max" for appropriate legend labels</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>rankedpars<span class="sc">$</span>NSE[rankedpars<span class="sc">$</span>NSE <span class="sc">==</span> <span class="st">"0"</span>] <span class="ot">&lt;-</span> <span class="st">"Min/Max"</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Make the ranks a factor datatype</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>rankedpars <span class="ot">&lt;-</span> rankedpars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ranks =</span> <span class="fu">factor</span>(ranks))</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">#Create parallel coordinate plot</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>rankedpars <span class="sc">%&gt;%</span> <span class="fu">ggparcoord</span>(<span class="at">columns =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>, </span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">groupColumn =</span> <span class="dv">13</span>,</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">showPoints =</span> <span class="cn">TRUE</span>,</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">scale =</span> <span class="st">"uniminmax"</span>) <span class="sc">+</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>              <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ggtitle</span>(<span class="st">"Top 10 parameter sets from 100,000 run Monte Carlo"</span>)<span class="sc">+</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ylab</span>(<span class="st">"normalized parameter values"</span>)<span class="sc">+</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">xlab</span>(<span class="st">"parameters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="17-Calibrate-HBV_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>

</main> <!-- /main -->
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  var t = document.getElementsByClassName("webex-total_correct");
  for (var i = 0; i < t.length; i++) {
    p = t[i].parentElement;
    var correct = p.getElementsByClassName("webex-correct").length;
    var solvemes = p.getElementsByClassName("webex-solveme").length;
    var radiogroups = p.getElementsByClassName("webex-radiogroup").length;
    var selects = p.getElementsByClassName("webex-select").length;

    t[i].innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* check answers */
check_func = function() {
  console.log("webex: check answers");

  var cl = this.parentElement.classList;
  if (cl.contains('unchecked')) {
    cl.remove("unchecked");
    this.innerHTML = "Hide Answers";
  } else {
    cl.add("unchecked");
    this.innerHTML = "Show Answers";
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  var check_sections = document.getElementsByClassName("webex-check");
  console.log("check:", check_sections.length);
  for (var i = 0; i < check_sections.length; i++) {
    check_sections[i].classList.add("unchecked");

    let btn = document.createElement("button");
    btn.innerHTML = "Show Answers";
    btn.classList.add("webex-check-button");
    btn.onclick = check_func;
    check_sections[i].appendChild(btn);

    let spn = document.createElement("span");
    spn.classList.add("webex-total_correct");
    check_sections[i].appendChild(spn);
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    solveme[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    selects[i].insertAdjacentHTML("afterend", " <span class='webex-icon'></span>")
  }

  update_total_correct();
}

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./16-Modeling-Getting-Started-HBV.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Intro to Modeling - Getting Started with HBV</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->



</body></html>